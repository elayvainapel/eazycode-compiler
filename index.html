<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>eazyCode Online Compiler</title>
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #1d283a 0, #020617 55%, #000 100%);
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      padding: 32px 12px;
    }

    .shell {
      width: 100%;
      max-width: 1100px;
      background: rgba(15, 23, 42, 0.96);
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow:
        0 22px 45px rgba(15, 23, 42, 0.8),
        0 0 0 1px rgba(15, 23, 42, 0.8);
      overflow: hidden;
      backdrop-filter: blur(22px);
    }

    .header {
      padding: 14px 20px 10px;
      border-bottom: 1px solid rgba(31, 41, 55, 0.9);
      display: flex;
      align-items: center;
      gap: 10px;
      background: linear-gradient(to right, #020617, #020617, #111827);
    }

    .traffic-dots {
      display: flex;
      gap: 6px;
      margin-right: 4px;
    }

    .traffic-dots span {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      display: inline-block;
    }
    .dot-red { background: #f97373; }
    .dot-yellow { background: #facc15; }
    .dot-green { background: #22c55e; }

    .title-area {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .title-main {
      font-size: 16px;
      font-weight: 600;
      letter-spacing: 0.03em;
    }

    .title-sub {
      font-size: 12px;
      color: #9ca3af;
    }

    .badge {
      margin-left: auto;
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: #c4d4ff;
      background: radial-gradient(circle at top left, #1d4ed8, #020617);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .main {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
      min-height: 420px;
    }

    .panel {
      display: flex;
      flex-direction: column;
      border-right: 1px solid rgba(31, 41, 55, 0.9);
    }
    .panel:last-child { border-right: none; }

    .panel-header {
      padding: 8px 16px;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      border-bottom: 1px solid rgba(31, 41, 55, 0.9);
      background: radial-gradient(circle at top left, #0f172a, #020617);
      display: flex;
      align-items: center;
      gap: 8px;
      color: #9ca3af;
    }

    .panel-header span.label {
      font-weight: 600;
      color: #e5e7eb;
    }

    .panel-header span.hint {
      font-size: 11px;
      margin-left: 6px;
      color: #6b7280;
    }

    .panel-header .header-right {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel-body {
      padding: 10px 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      height: 100%;
    }

    textarea {
      width: 100%;
      flex: 1;
      resize: none;
      border-radius: 10px;
      background: #020617;
      border: 1px solid rgba(55, 65, 81, 0.98);
      color: #e5e7eb;
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
      font-size: 13px;
      padding: 10px 11px;
      outline: none;
      line-height: 1.45;
      tab-size: 2;
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.8);
    }
    textarea:focus {
      border-color: #22c55e;
      box-shadow:
        0 0 0 1px rgba(34, 197, 94, 0.7),
        0 0 0 6px rgba(22, 163, 74, 0.25);
    }

    pre {
      margin: 0;
      flex: 1;
      border-radius: 10px;
      background: #020617;
      border: 1px solid rgba(55, 65, 81, 0.98);
      color: #e5e7eb;
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
      font-size: 13px;
      padding: 10px 11px;
      line-height: 1.45;
      white-space: pre-wrap;
      word-break: break-word;
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.8);
    }

    .controls {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 6px;
      gap: 8px;
    }

    .hint-ghost {
      font-size: 11px;
      color: #6b7280;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 7px 16px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: linear-gradient(135deg, #22c55e, #4ade80);
      color: #052e16;
      box-shadow:
        0 10px 18px rgba(34, 197, 94, 0.35),
        0 0 0 1px rgba(22, 163, 74, 0.7);
    }
    button:hover {
      background: linear-gradient(135deg, #4ade80, #bbf7d0);
      transform: translateY(-0.5px);
      box-shadow:
        0 14px 24px rgba(34, 197, 94, 0.4),
        0 0 0 1px rgba(22, 163, 74, 0.9);
    }
    button:active {
      transform: translateY(1px);
      box-shadow:
        0 6px 10px rgba(34, 197, 94, 0.3),
        0 0 0 1px rgba(22, 163, 74, 0.7);
    }

    .btn-icon {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 2px solid #052e16;
      background: #bbf7d0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 9px;
    }

    .status {
      font-size: 11px;
      color: #9ca3af;
    }
    .status-dot {
      display: inline-block;
      width: 7px;
      height: 7px;
      border-radius: 999px;
      margin-right: 5px;
      background: #6b7280;
    }
    .status.success { color: #4ade80; }
    .status.error { color: #f97373; }
    .status.success .status-dot { background: #22c55e; }
    .status.error .status-dot { background: #f97373; }

</style>
</head>
<body>
<div class="shell">

    <!-- HEADER -->
    <div class="header">
      <div class="traffic-dots">
        <span class="dot-red"></span>
        <span class="dot-yellow"></span>
        <span class="dot-green"></span>
      </div>
      <div class="title-area">
        <div class="title-main">eazyCode Online Compiler</div>
        <div class="title-sub">Code inside Main.main(main.execute(1)) like Java, but yours</div>
      </div>
      <div class="badge">v0.2 · strict mode</div>
    </div>

    <div class="main">

      <!-- Left Panel: Editor -->
      <div class="panel">
        <div class="panel-header">
          <span class="label">Editor</span>
          <span class="hint">Strict syntax · requires semicolons</span>
          <div class="header-right">
            <button onclick="runEazyCode()">
              <span class="btn-icon">▶</span>
              Run
            </button>
          </div>
        </div>

        <div class="panel-body">
          <textarea id="code" spellcheck="false">public class Main {
    public static void main(main.execute(1)) {
        int x = 5;
        console.print(x);
    }
}</textarea>

          <div class="controls">
            <span id="status" class="status"><span class="status-dot"></span>Ready</span>
            <span class="hint-ghost">Every statement must end with ; now</span>
          </div>
        </div>
      </div>

      <!-- Right Panel: Output -->
      <div class="panel">
        <div class="panel-header">
          <span class="label">Output</span>
          <span class="hint">Result of your program</span>
        </div>
        <div class="panel-body">
          <pre id="output"></pre>
        </div>
      </div>

    </div>
</div>


<script>

// ====================================================================================
// UTILITIES
// ====================================================================================

const outputEl = document.getElementById("output");
const statusEl = document.getElementById("status");
const editorEl = document.getElementById("code");

const eazyConsole = {
  print(value = "") {
    outputEl.textContent += String(value);
    return this;
  },
  dl() {
    outputEl.textContent += "\n";
    return this;
  }
};

function setStatus(text, type = "normal") {
  statusEl.textContent = "";
  const dot = document.createElement("span");
  dot.className = "status-dot";

  statusEl.className = "status";
  if (type === "success") statusEl.classList.add("success");
  if (type === "error") statusEl.classList.add("error");

  statusEl.appendChild(dot);
  statusEl.appendChild(document.createTextNode(" " + text));
}

function translateExpression(expr) {
  let e = expr.trim();
  e = e.replace(/first\.Int/g, "first_Int");
  e = e.replace(/sum\.Int/g, "sum_Int");
  e = e.replace(/eachSum\.Int/g, "eachSum_Int");
  e = e.replace(/eachFirst\.Int/g, "eachFirst_Int");
  return e;
}

// ====================================================================================
// EXTRACT MAIN BODY
// ====================================================================================

function extractMainBody(source) {
  const sig = "public static void main(main.execute(1))";
  const sigIndex = source.indexOf(sig);
  if (sigIndex === -1) throw new Error("main.execute(1) method not found");

  const braceStart = source.indexOf("{", sigIndex);
  if (braceStart === -1) throw new Error("Opening { for main not found");

  let depth = 1;
  let bodyStart = braceStart + 1;
  for (let i = braceStart + 1; i < source.length; i++) {
    if (source[i] === "{") depth++;
    else if (source[i] === "}") {
      depth--;
      if (depth === 0) {
        return source.slice(bodyStart, i);
      }
    }
  }

  throw new Error("Could not find matching } for main");
}

// ====================================================================================
// MULTI-ERROR COMPILER
// ====================================================================================

function compileEazy(rawCode) {
  let errors = [];
  let jsOutput = [];
  let lineCounter = 1;

  // Split into semicolon-based segments (each segment is a separate statement)
  const rawLines = rawCode.split(/\r?\n/);

  // Convert `a=5; console.print(a);` into separate virtual lines
  let virtualLines = [];

  rawLines.forEach((fullLine, idx) => {
    const parts = fullLine.split(";");

    for (let i = 0; i < parts.length; i++) {
      const segment = parts[i].trim();

      if (segment === "" && i < parts.length - 1) {
        virtualLines.push({ text: ";", lineNumber: idx + 1 });
        continue;
      }

      if (segment !== "") {
        virtualLines.push({
          text: segment + (i < parts.length - 1 ? ";" : ""),
          lineNumber: idx + 1
        });
      }
    }
  });

  // ==========================================
  // PARSE EACH VIRTUAL LINE
  // ==========================================

  virtualLines.forEach(({ text, lineNumber }) => {
    let line = text.trim();

    if (line === "") {
      jsOutput.push("");
      return;
    }

    // --------------------------
    // Semicolon enforcement
    // --------------------------
    const needsSemicolon =
      !line.endsWith("{") &&
      !line.endsWith("}") &&
      !line.startsWith("if ") &&
      !line.startsWith("else") &&
      !line.startsWith("while ") &&
      !line.startsWith("for ");

    if (needsSemicolon && !line.endsWith(";")) {
      errors.push(`[Error] Line ${lineNumber}: Missing semicolon at end of line`);
      return;
    }

    const clean = line.endsWith(";")
      ? line.slice(0, -1).trim()
      : line;

    // --------------------------
    // Comments
    // --------------------------
    if (clean.startsWith("//")) {
      jsOutput.push("//" + clean.slice(2));
      return;
    }

    // --------------------------
    // console.print + .dl
    // --------------------------
    let m = clean.match(/^console\.print\((.*)\)\s*\+\s*\.dl\(\)$/);
    if (m) {
      const inner = m[1].trim();
      const jsExpr = inner ? translateExpression(inner) : `""`;
      jsOutput.push(`eazyConsole.print(${jsExpr});`);
      jsOutput.push(`eazyConsole.dl();`);
      return;
    }

    // --------------------------
    // console.print
    // --------------------------
    m = clean.match(/^console\.print\((.*)\)$/);
    if (m) {
      const inner = m[1].trim();
      const jsExpr = inner ? translateExpression(inner) : `""`;
      jsOutput.push(`eazyConsole.print(${jsExpr});`);
      return;
    }

    // --------------------------
    // declarations: int / String / var
    // --------------------------
    m = clean.match(/^(int|String|var)\s+([A-Za-z_]\w*)\s*=\s*(.+)$/);
    if (m) {
      const name = m[2];
      const expr = translateExpression(m[3]);
      jsOutput.push(`let ${name} = ${expr};`);
      return;
    }

    // --------------------------
    // for-range
    // --------------------------
    m = clean.match(
      /^for\s*\(\s*int\s+([A-Za-z_]\w*)\s*:\s*range\+\+\(\s*(.+)\s*,\s*(.+)\s*\)\s*\)$/
    );
    if (m) {
      const varName = m[1];
      jsOutput.push(
        `for (let ${varName} = ${translateExpression(
          m[2]
        )}; ${varName} <= ${translateExpression(m[3])}; ${varName}++) {`
      );
      return;
    }

    // --------------------------
    // if / while
    // --------------------------
    if (clean.startsWith("if ") || clean.startsWith("while ")) {
      const idxOpen = clean.indexOf("(");
      const idxClose = clean.lastIndexOf(")");
      if (idxOpen === -1 || idxClose === -1 || idxClose < idxOpen) {
        errors.push(`[Error] Line ${lineNumber}: Malformed if/while syntax`);
        return;
      }
      const before = clean.slice(0, idxOpen + 1);
      const expr = clean.slice(idxOpen + 1, idxClose);
      const after = clean.slice(idxClose);
      jsOutput.push(before + translateExpression(expr) + after);
      return;
    }

    // --------------------------
    // assignment x = expr
    // --------------------------
    m = clean.match(/^([A-Za-z_]\w*)\s*=\s*(.+)$/);
    if (m) {
      jsOutput.push(`${m[1]} = ${translateExpression(m[2])};`);
      return;
    }

    // --------------------------
    // UNKNOWN LINE: error
    // --------------------------
    errors.push(`[Error] Line ${lineNumber}: Cannot compile line: '${clean}'`);
  });

  return { jsOutput, errors };
}

// ====================================================================================
// RUN COMPILER
// ====================================================================================

function runEazyCode() {
  const fullSource = editorEl.value;
  outputEl.textContent = "";
  setStatus("Extracting...", "normal");

  try {
    const body = extractMainBody(fullSource);
    setStatus("Compiling...", "normal");

    const { jsOutput, errors } = compileEazy(body);

    if (errors.length > 0) {
      setStatus("Error", "error");
      outputEl.textContent = errors.join("\n") + "\n";
      return;
    }

    setStatus("Running...", "normal");
    eval(jsOutput.join("\n"));
    setStatus("Done", "success");

  } catch (err) {
    outputEl.textContent = "[Error] " + err.message;
    setStatus("Error", "error");
  }
}

</script>

</body>
</html>
