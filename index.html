<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>eazyCode Compiler</title>
<style>
    *{box-sizing:border-box;}
    body{
        margin:0;
        min-height:100vh;
        background:#0f172a;
        color:#e5e7eb;
        font-family:system-ui;
        display:flex;
        justify-content:center;
        padding:20px;
    }
    .shell{
        width:100%;
        max-width:1100px;
        background:#111827;
        border-radius:14px;
        border:1px solid #334155;
        padding:20px;
    }
    textarea{
        width:100%;
        height:300px;
        background:#0f172a;
        border:1px solid #334155;
        border-radius:10px;
        color:#e5e7eb;
        font-family:ui-monospace;
        font-size:14px;
        padding:10px;
        outline:none;
        white-space:pre;
    }
    textarea:focus{
        border-color:#22c55e;
        box-shadow:0 0 0 3px rgba(34,197,94,.3);
    }
    pre{
        margin-top:12px;
        white-space:pre-wrap;
        background:#0f172a;
        border:1px solid #334155;
        border-radius:10px;
        padding:10px;
        min-height:150px;
    }
    button{
        margin-top:14px;
        padding:8px 20px;
        background:#22c55e;
        border:none;
        border-radius:20px;
        font-size:15px;
        font-weight:600;
        cursor:pointer;
        color:#052e16;
    }
    button:hover{
        background:#4ade80;
    }
    .error{
        color:#f87171;
        font-weight:bold;
    }
</style>
</head>
<body>

<div class="shell">
    <h2>eazyCode Online Compiler</h2>

    <textarea id="code" spellcheck="false">public class Main {
    public static void main(main.execute(1)) {
        console.print("hello world!");
    }
}</textarea>

    <button onclick="runEazy()">Run</button>
    <pre id="output"></pre>
</div>

<script>
const editor = document.getElementById("code");
const output = document.getElementById("output");

/* ====== SMART EDITOR FEATURES ====== */

function insertPair(ed, open, close, e){
    e.preventDefault();
    let s = ed.selectionStart;
    let epos = ed.selectionEnd;
    let v = ed.value;
    let sel = v.slice(s, epos);

    if(sel.length > 0){
        ed.value = v.slice(0,s)+open+sel+close+v.slice(epos);
        ed.selectionStart = s+1;
        ed.selectionEnd = epos+1;
    } else {
        ed.value = v.slice(0,s)+open+close+v.slice(epos);
        ed.selectionStart = ed.selectionEnd = s+1;
    }
}

function insertText(ed,str,e){
    e.preventDefault();
    let s=ed.selectionStart, epos=ed.selectionEnd;
    let v = ed.value;
    ed.value = v.slice(0,s) + str + v.slice(epos);
    ed.selectionStart = ed.selectionEnd = s+str.length;
}

editor.addEventListener("keydown", function(e){
    let ed = editor;

    /* autocomplete () [] "" */
    if(e.key==="("){ insertPair(ed,"(",")",e); return; }
    if(e.key==="["){ insertPair(ed,"[","]",e); return; }
    if(e.key==='"'){ insertPair(ed,'"','"',e); return; }

    /* smart backspace for pairs & 4 spaces */
    if(e.key==="Backspace"){
        let pos = ed.selectionStart;
        if(pos>0 && ed.selectionStart===ed.selectionEnd){
            let val = ed.value;
            let prev = val[pos-1];
            let next = val[pos];

            let pairs = {"(" : ")", "[" : "]", '"' : '"' };
            if(pairs[prev] && pairs[prev]===next){
                e.preventDefault();
                ed.value = val.slice(0,pos-1)+val.slice(pos+1);
                ed.selectionStart = ed.selectionEnd = pos-1;
                return;
            }

            if(pos>=4 && val.slice(pos-4,pos)==="    "){
                e.preventDefault();
                ed.value = val.slice(0,pos-4)+val.slice(pos);
                ed.selectionStart = ed.selectionEnd = pos-4;
                return;
            }
        }
    }

    /* tab inserts 4 spaces */
    if(e.key==="Tab"){ insertText(ed,"    ",e); return; }

    /* Enter indentation logic + { block logic */
    if(e.key==="Enter"){
        let pos = ed.selectionStart;
        let val = ed.value;
        let before = val.slice(0,pos);
        let after = val.slice(pos);

        let lastNL = before.lastIndexOf("\n");
        let start = lastNL===-1?0:lastNL+1;
        let line = before.slice(start);
        let indent = line.match(/^[\t ]*/)[0];
        let trimmed = line.trimEnd();
        let indentUnit = "    ";

        e.preventDefault();

        if(trimmed.endsWith("{")){
            ed.value =
                before + "\n" +
                indent + indentUnit + "\n" +
                indent + "}" +
                after;

            let newPos = before.length + 1 + indent.length + indentUnit.length;
            ed.selectionStart = ed.selectionEnd = newPos;
            return;
        }

        ed.value = before + "\n" + indent + after;
        ed.selectionStart = ed.selectionEnd = before.length + 1 + indent.length;
        return;
    }
});

/* ====== COMPILER HELPERS ====== */

function extractMainBody(src){
    const sig = "public static void main(main.execute(1))";
    let i = src.indexOf(sig);
    if(i<0) throw {msg:"main(main.execute(1)) not found", line:0};

    let brace = src.indexOf("{", i);
    if(brace<0) throw {msg:"opening { not found for main", line:0};

    let depth=1;
    for(let j=brace+1;j<src.length;j++){
        if(src[j]==="{") depth++;
        if(src[j]==="}") depth--;
        if(depth===0){
            return src.slice(brace+1,j);
        }
    }
    throw {msg:"closing } not found for main", line:0};
}

function translateExpression(expr){
    return expr
        .replace(/first\.Int/g,"first_Int")
        .replace(/sum\.Int/g,"sum_Int")
        .replace(/eachSum\.Int/g,"eachSum_Int")
        .replace(/eachFirst\.Int/g,"eachFirst_Int");
}

const eazyConsole = {
    print(v=""){ output.textContent+=String(v); return this; },
    dl(){ output.textContent+="\n"; return this; },
    ul(){ output.textContent+="\n"; return this; }
};

function first_Int(s){ let m=String(s).match(/\d+/); return m?+m[0]:0; }
function sum_Int(s){ let m=String(s).match(/\d+/g)||[]; return m.reduce((a,b)=>a+ +b,0); }
function eachSum_Int(s){ let m=String(s).match(/\d/g)||[]; return m.reduce((a,b)=>a+ +b,0); }
function eachFirst_Int(s){ let m=String(s).match(/\d/); return m?+m[0]:0; }


/* ====== FULL COMPILER WITH MULTIPLE ERRORS ====== */

function compileEazy(code){
    let errors = [];

    let lines = code.split("\n");

    let tokens = [];
    lines.forEach((line,idx)=>{
        let parts=line.split(";");
        for(let i=0;i<parts.length;i++){
            let seg = parts[i].trim();
            if(seg==="" && i<parts.length-1){
                tokens.push({text:";", line:idx+1});
                continue;
            }
            if(seg!==""){
                tokens.push({text:seg+(i<parts.length-1?";":""), line:idx+1});
            }
        }
    });

    let out=[];

    for(let t of tokens){
        let raw=t.text;
        let ln = t.line;
        let line = raw.trim();

        if(line==="" ){ out.push(""); continue; }

        if(!(
            line.endsWith(";") ||
            line.endsWith("{") ||
            line.endsWith("}") ||
            line.startsWith("for") ||
            line.startsWith("if") ||
            line.startsWith("else") ||
            line.startsWith("while")
        )){
            errors.push(`Line ${ln}: Missing semicolon â†’ "${line}"`);
            continue;
        }

        let clean = line.endsWith(";") ? line.slice(0,-1).trim() : line;

        if(clean.startsWith("console.print") && code.indexOf("main.execute(1)")<0){
            errors.push(`Line ${ln}: console.print cannot be outside main`);
        }

        try{
            /* console.print()+.dl() */
            let m;
            m = clean.match(/^console\.print\((.*)\)\s*\+\s*\.dl\(\)$/);
            if(m){
                let inner=m[1].trim();
                let js = inner?translateExpression(inner):'""';
                out.push(`eazyConsole.print(${js});`);
                out.push(`eazyConsole.dl();`);
                continue;
            }

            m = clean.match(/^console\.print\((.*)\)$/);
            if(m){
                let inner=m[1].trim();
                let js = inner?translateExpression(inner):'""';
                out.push(`eazyConsole.print(${js});`);
                continue;
            }

            m = clean.match(/^(int|String|var)\s+([A-Za-z_]\w*)\s*=\s*(.+)$/);
            if(m){
                out.push(`let ${m[2]}=${translateExpression(m[3])};`);
                continue;
            }

            m = clean.match(/^for\s*\(\s*int\s+([A-Za-z_]\w*)\s*:\s*range\+\+\((.+),(.+)\)\)$/);
            if(m){
                let v=m[1];
                let a=translateExpression(m[2]);
                let b=translateExpression(m[3]);
                out.push(`for(let ${v}=${a};${v}<=${b};${v}++){`);
                continue;
            }

            if(clean.startsWith("if") || clean.startsWith("while") || clean.startsWith("else if")){
                let o=line.indexOf("(");
                let c=line.lastIndexOf(")");
                let before=line.slice(0,o+1);
                let expr=line.slice(o+1,c);
                let after=line.slice(c);
                out.push(before+translateExpression(expr)+after);
                continue;
            }

            m = clean.match(/^([A-Za-z_]\w*)\s*=\s*(.+)$/);
            if(m){
                out.push(`${m[1]}=${translateExpression(m[2])};`);
                continue;
            }

            if(line==="{"||line==="}"){ out.push(line); continue; }

            throw "unrecognized";

        }catch{
            errors.push(`Line ${ln}: Cannot compile "${line}"`);
        }
    }

    if(errors.length>0) throw errors;

    return out.join("\n");
}

/* ====== RUN ====== */

function runEazy(){
    output.textContent="";
    try{
        let src = editor.value;
        let body = extractMainBody(src);
        let js = compileEazy(body);
        eval(js);
    }catch(err){
        if(Array.isArray(err)){
            output.innerHTML = "<span class='error'>" + err.join("\n") + "</span>";
        } else {
            output.innerHTML = "<span class='error'>"+err.msg+"</span>";
        }
    }
}
</script>
</body>
</html>
